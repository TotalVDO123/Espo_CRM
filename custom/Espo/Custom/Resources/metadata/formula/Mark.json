{
    "beforeSaveCustomScript": "name = datetime\\format(datetime\\now(), 'Europe/Kiev', 'DD.MM.YYYY HH:mm');\n\n//add default team\n$defaultTeamId = env\\userAttribute('defaultTeamId');\n$defaultTeamIdList = list($defaultTeamId);\nentity\\addLinkMultipleId('teams', $defaultTeamIdList);",
    "beforeSaveApiScript": "if (!recordService\\skipDuplicateCheck()) {\n    $id = record\\findOne('Mark', null, null, 'abonementId=', abonementId, 'trainingId=', trainingId);\n    \n    if ($id) {\n        recordService\\throwConflict('Абонемент вже відмічений на цьому занятті');\n    }\n}\n\n//Validation if creating via button 'З іншої групи'\nif (isOtherGroup) {\n    //$abonId = record\\findOne('Abonement', null, null, 'id=', abonementId);\n    $abon = record\\fetch('Abonement', abonementId);\n    $training = record\\fetch('Training', trainingId);\n    \n    if (object\\get($abon, 'isActivated') == false) {\n        recordService\\throwForbidden('Абонемент не активованиий');\n    }\n    \n    if (object\\get($abon, 'isFreezed')) {\n        recordService\\throwForbidden('Абонемент заморожено');\n    }\n    \n    if (datetime\\diff(object\\get($abon, 'endDate'), datetime\\today(), 'days') < 0) {\n        recordService\\throwForbidden('Термін дії абонемента минув');\n    }\n    \n    if (object\\get($abon, 'classesLeft') <= 0) {\n        recordService\\throwForbidden('Абонемент вичерпано');\n    }\n    //is training in abon range\n    if (datetime\\diff(object\\get($abon, 'startDate'), object\\get($training, 'startDateOnly'), 'days') > 0 \n            || datetime\\diff(object\\get($abon, 'endDate'), object\\get($training, 'startDateOnly'), 'days') < 0) {\n        recordService\\throwForbidden('Абонемент діє за межами цього заняття');\n    }\n}"
}